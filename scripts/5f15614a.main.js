Livsloner=function(){function a(a,b,c,d,e){var f=this;f.mobile=b,f.data=c,f.groups=d,f.educationDictionary=e,f.container=d3.select(a);var g=f.container[0][0].offsetWidth;f.chartContainer=f.container.append("div").attr("class","chart "+(b?"mobile":"desktop"));var h={top:10,right:200,bottom:30,left:70},i={top:10,right:40,bottom:30,left:27};f.margin=m=b?i:h,f.width=g-m.left-m.right;var j=b?270:320;f.height=j-m.top-m.bottom,f.drawNavigation(),f.drawCanvas(),f.sentenceContainer=f.chartContainer.append("div").attr("class","sentence"),f.sentenceContainer.append("div").attr("class","header"),f.sentenceContainer.append("div").attr("class","body"),f.initChart()}a.prototype.drawNavigation=function(){var a=this;if(a.mobile){a.navigationContainer=a.container.insert("div",":first-child").attr("class","navigation");var b=d3.select("#navigation-mobile")}else{a.navigationContainer=a.container.append("div").attr("class","navigation "+(a.mobile?"mobile":"desktop"));var b=d3.select("#navigation-desktop")}var c=b.html(),d=Handlebars.compile(c);a.navigationContainer.html(d(a.groups)),a.navigationContainer.selectAll(".profession").on("change",function(){a.update()}),a.navigationContainer.selectAll(".panel-heading").on("click",function(){d3.selectAll(".profession").property("checked",!1),d3.select(this.parentElement).selectAll(".profession").property("checked",!0),a.update()})},a.prototype.drawCanvas=function(){var a=this,b=a.width,c=a.height,d=a.margin;a.svg=a.chartContainer.append("svg").attr("width",b+d.left+d.right).attr("height",c+d.top+d.bottom),a.chart=a.svg.append("g").attr("transform","translate("+d.left+","+d.top+")")},a.prototype.initChart=function(){var a=this;a.x=d3.scale.linear().range([0,a.width]).domain([19,85]),a.y=d3.scale.linear().range([a.height,0]).domain([0,265e5]),a.xAxis=d3.svg.axis().scale(a.x).ticks(a.mobile?5:10).orient("bottom"),a.yAxis=d3.svg.axis().scale(a.y).tickFormat(function(a){return a/1e6}).orient("left"),a.line=d3.svg.line().interpolate("linear").x(function(b){return a.x(b.age)}).y(function(b){return a.y(b.salary)}),a.areaAbove=d3.svg.area().interpolate("basis").x(a.line.x()).y0(function(b){return a.y(b.baseline)}).y1(function(b){return a.y(Math.max(b.baseline,b.salary))}),a.areaBelow=d3.svg.area().interpolate("basis").x(a.line.x()).y0(function(b){return a.y(b.baseline)}).y1(function(b){return a.y(Math.min(b.baseline,b.salary))}),a.overlay=a.svg.append("rect").attr("class","overlay").attr("width",a.width+a.margin.left+a.margin.right).attr("height",a.height+a.margin.top+a.margin.bottom).attr("fill","#fff"),a.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+a.height+")").call(a.xAxis).append("text").attr("x",0).attr("transform","translate("+a.width+",0)").attr("dy","-.35em").style("text-anchor","end").attr("class","caption").text("Ålder"),a.chart.append("g").attr("class","y axis").call(a.yAxis).append("text").attr("transform","rotate(-90)").attr("x",-10).attr("y",6).attr("dy",".71em").style("text-anchor","end").attr("class","caption").text("Livslön efter skatt (Mkr)"),a.mobile||$(".y.axis .caption").tooltip({container:"body",placement:"right",title:"I begreppet livslön inräknas både lön och pension efter skatt, studiemedel räknas som inkomst under studietiden. Den årliga avbetalningen av studieskulden dras bort från lönen under återbetalningstiden. Hänsyn tas till att risken för arbetslöshet varierar mellan olika akademikergrupper och gymnasieutbildade. Alla beräkningar är gjorda utifrån 2009 års siffror."})},a.prototype.drawBaseline=function(){},a.prototype.updateLines=function(a){var b=this;b.lineGroups.exit().transition().remove(),b.enteringLineGroups=b.lineGroups.enter().append("g").attr("class",function(a,b){return"line-group "+(0==b?"baseline":"profession-line")});var c=b.enteringLineGroups.append("g").attr("class","path-group").datum(function(a){return a.values});c.append("path").attr("class","line").attr("d",b.line),c.append("path").attr("class","area above"),c.append("path").attr("class","area below"),b.mobile||b.enteringLineGroups.on("mouseover",function(){var a=this;b.updateBackgroundArea({self:b}),d3.select(this).classed("highlighted",!0),b.lineGroups.classed("faded",function(){return this!==a&&!d3.select(this).classed("baseline")});var c=b.chart.select(".line-group.baseline")[0][0];b.breakEven=f(c.__data__,a.__data__),b.finalSalaries=h(c.__data__,a.__data__),console.log(b.finalSalaries),b.addBreakEven(),b.addSentence()}).on("mouseout",function(){b.lineGroups.classed("faded",!1),2!==b.lineGroups[0].length&&(b.lineGroups.classed("highlighted",!1),b.removeAnnotation())}),l(a)},a.prototype.updateBackgroundArea=function(a){var b;a&&a.self&&(b=a.self);var c=b.chart.select(".baseline")[0][0].__data__.values,d=function(a){return a.map(function(a,b){return a.baseline=c[b].salary,a})},e=b.chart.selectAll(".path-group").datum(function(a){return d(a)});e.selectAll(".area.above").attr("d",b.areaAbove),e.selectAll(".area.below").attr("d",b.areaBelow);var f=c[c.length-1].salary;b.chart.selectAll(".line-group").sort(function(a,b){return Math.abs(f-b.finalSalary)-Math.abs(f-a.finalSalary)})},a.prototype.addBreakEven=function(a){var b;if(a?a.self&&(b=a.self):b=this,b.breakEven){var c=b.x(b.breakEven.age),d=b.y(b.breakEven.salary),e=b.width-c<50,f=5;b.breakEvenGroup=b.chart.append("g").attr("transform","translate("+[c,d]+")").attr("class","break-even annotation"),b.breakEvenGroup.append("circle").attr("r",0).transition().duration(800).ease("bounce").attr("r",f),b.breakEvenGroup.append("text").text(b.breakEven.age+" år").attr("dy",".35em").attr("x",(f+4)*(e?-1:1)).attr("class","label").attr("text-anchor",e?"end":"start")}},a.prototype.addSentence=function(a){var b;a?a.self&&(b=a.self):b=this;var c=(b.chart.select(".baseline.line-group")[0][0].__data__.label.toLowerCase(),g(b.breakEven,b.finalSalaries,b.educationDictionary));b.sentenceContainer.classed("hidden",!1),b.sentenceContainer.select(".header").html(b.finalSalaries.professionLabel),b.sentenceContainer.select(".body").html(c)},a.prototype.highlightSelectedProfession=function(a){var b;a?a.self&&(b=a.self):b=this,b.chart.selectAll(".profession-line").classed("highlighted",!0)},a.prototype.annotateDifference=function(a){var b;if(a?a.self&&(b=a.self):b=this,b.finalSalaries){var c=(b.y(b.finalSalaries.baseline)+b.y(b.finalSalaries.profession))/2,d=b.height-b.y(Math.abs(b.finalSalaries.difference)),e=b.finalSalaries.difference>0?"plus":"minus",f=b.chart.append("g").attr("class","difference annotation "+e).attr("transform","translate("+[b.width,c]+")");f.append("line").attr("x1",0).attr("x2",0).attr("y1",-d/2).attr("y2",d/2),f.append("text").attr("dy",".75em").attr("y",5).attr("transform","rotate(-90)").text("Skillnad: "+(b.finalSalaries.difference>0?"+":"")+formatMillionSEK(b.finalSalaries.difference))}},a.prototype.annotateLines=function(a){var b;a?a.self&&(b=a.self):b=this;var c={above:{x:.2,y:.32},below:{x:.5,y:.8}},d=b.lineGroups.append("g").attr("class","line-label annotation").attr("transform",function(a,d){var e,f=0==d;e=f?b.breakEven.age<55?"below":"above":b.breakEven.age<55?"above":"below";var g=c[e].x*b.width,h=c[e].y*b.height;return"translate("+[g,h]+")"});d.append("text").each(function(a){var b=j(a.label,15);k(b,this)});var e=6;d.append("rect").attr("class","color-key").attr("x",-e-4).attr("y",-7).attr("width",e).attr("height",e)},a.prototype.updateDesktopLabels=function(a){var b;a?a.self&&(b=a.self):b=this;var c=b.enteringLineGroups.append("g").attr("class","label-group").attr("transform",function(a){var c=b.width,d=b.y(a.finalSalary);return"translate("+[c,d]+")"});c.append("text").each(function(a){var b=j(a.label,15);k(b,this)}).attr("transform","translate(19,5)"),c.append("line").attr("class","label-line").attr("x1",4).attr("x2",15).attr("y1",0).attr("y2",0),b.lineGroups.sort(function(a,b){return b.finalSalary-a.finalSalary});var d=0,e=-99999;b.lineGroups.selectAll(".label-group").each(function(a){var c,f=f=d3.select(this),g=b.y(a.finalSalary),h=g-e;c=h>d?0:d-h+3,e=g+c,f.transition().duration(300).attr("transform","translate("+[b.width,g+c]+")"),f.select("line").transition().duration(300).attr("y1",-c),d=f.select("text").node().getBoundingClientRect().height})},a.prototype.removeAnnotation=function(){var a=this;a.chart.selectAll(".annotation").remove(),a.chart.selectAll(".profession-line").classed("highlighted",!1),a.sentenceContainer.classed("hidden",!0),a.sentenceContainer.selectAll(".body, .header").html("")},a.prototype.update=function(){var a=this,g=b();if(g.length){var i=d(g);g.unshift({label:e(i),column:i})}a.container.classed("no-selection",0==g.length);var j=c(a.data,g);a.lineGroups=a.chart.selectAll("g.line-group").data(j,function(a){return a.column}),a.removeAnnotation();var k=[];if(a.mobile||k.push({fn:a.updateDesktopLabels,args:{self:a}}),2==j.length){a.breakEven=f(j[0],j[1]),a.finalSalaries=h(j[0],j[1]),k.push({fn:a.updateBackgroundArea,args:{self:a}},{fn:a.addBreakEven,args:{self:a}},{fn:a.addSentence,args:{self:a}}),a.mobile?k.push({fn:a.annotateDifference,args:{self:a}},{fn:a.annotateLines,args:{self:a}}):k.push({fn:a.highlightSelectedProfession,args:{self:a}});var m=a.lineGroups.enter()[0].filter(function(a){return a}).length;0==m&&l(k)}k.push({fn:app.sendHeight}),a.updateLines(k)};var b=function(){var a=[];if(app.mobile){var b=$(".profession").val();b&&a.push(b)}else $(".profession:checked").each(function(){a.push($(this).val())});return a.map(function(a){var b=a.split("|");return{label:b[0],column:b[1],baseline:b[2]}})},c=function(a,b){return b.map(function(b){return{column:b.column,label:b.label,finalSalary:a[a.length-1][b.column],values:a.map(function(a){return{age:a.alder,salary:a[b.column]}})}})},d=function(a){var b=a.map(function(a){return a.baseline});return b.allValuesSame()?b[0]:"GymnTotal"},e=function(a){return"GymnSamhv"==a?"Samhällsvetenskapligt gymnasieutbildad":"GymnNatv"==a?"Naturvetenskapligt gymnasieutbildad":"Gymnasieutbildad"},f=function(a,b){for(var c=0;c<a.values.length;c++){var d=a.values[c].salary,e=b.values[c].salary;if(e>d)return a.values[c]}return!1},g=function(a,b,c){var d,e="",f=b.baseline==b.profession,g=Math.abs(1-b.profession/b.baseline),h=b.baselineLabel.toLowerCase();if(f)e+="En "+h+" person utan högre utbildning får i snitt en livslön på <strong>"+formatInSentence(b.profession)+"</strong>.";else{var i=c[b.professionColumn].education.toLowerCase();a?(e+="En person med "+i+" tjänar in sin utbildning vid <strong>"+a.age+" års ålder</strong>.",d="mer"):(e+="En person med "+i+" tjänar aldrig in sin utbildning.",d="mindre"),e+=" Livslönen för en person med den här utbildningen är <strong>"+formatInSentence(b.profession)+" kronor</strong>",e+=0==Math.round(100*g)?", vilket är ungefär <strong>lika mycket</strong> som en "+h+".":", vilket är cirka <strong>"+formatPercentInSentence(g)+" "+d+" </strong> än genomsnittet för en "+h+"."}return e},h=function(a,b){return{baseline:a.finalSalary,baselineLabel:a.label,baselineColumn:a.column,profession:b.finalSalary,professionLabel:b.label,professionColumn:b.column,difference:b.finalSalary-a.finalSalary}},j=function(a,b){var b=b||20,c=a.split(" "),d=0,e="";return c.forEach(function(a){d+a.length>b?(d=0,delimiter="\n"):(d+=a.length,delimiter=" "),e+=a+delimiter}),e},k=function(a,b){var c=a.split("\n");if(void 0!=c)for(i=0;i<c.length;i++)d3.select(b).append("tspan").text(c[i]).attr("dy",i?"1.2em":0).attr("x",0).attr("class","tspan"+i)},l=function(a){a.forEach(function(a){a.fn(a.args)})};return a}();var locale=d3.locale({decimal:",",thousands:" ",grouping:[3],currency:[""," kr"],dateTime:"%A %e %B %Y kl. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["måndag","tisdag","onsdag","torsdag","fredag","lördag","söndag"],shortDays:["må","ti","ons","to","fre","lö","sö"],months:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],shortMonths:["jan","feb","mars","apr","maj","jun","jul","aug","sept","okt","nov","dec"]}),formatMillionSEK=function(a){return locale.numberFormat(".2s")(a).replace("k"," tKr").replace("M"," Mkr")},formatInSentence=function(a){return locale.numberFormat(".3s")(a).replace("k","&nbsp;000 kronor").replace("M","&nbsp;miljoner kronor")},formatPercent=function(a){return locale.numberFormat("%")(a)},formatPercentInSentence=function(a){return locale.numberFormat("%")(a).replace("%"," procent")};Handlebars.registerHelper("slugify",function(a,b){var c=a.replace(/[^\w\s]+/gi,"").replace(/ +/gi,"-").replace("åä","a").replace("ö","o");return c.toLowerCase()}),app.sendHeight=function(){app.isIframe&&app.pymChild.sendHeight()},function(){app.init=function(){d3.csv(app.dataPath,function(a){var b={};for(key in a)b[key]=+a[key].replace(",",".");return b},function(a,b){app.data=b,$(app).trigger("app:dataReady")})}}(),function(){app.professionColumns=[[{name:"Pedagogik och lärarutbildning",nameShort:"Lärare",cssClass:"sort",items:[{label:"Förskollärare",education:"Förskollärarutbildning",column:"Forskolelarare",baseline:"GymnSamhv"},{label:"Grundlärare (årskurs 1-6)",education:"Lärarutbildning mot grundskolans tidiga år",column:"Lagmellanstdlr",baseline:"GymnSamhv"},{label:"Ämneslärare (årskurs 7-9/gymnasium)",education:"Lärarutbildning mot grundskolans senare eller gymnasium",column:"Amneslarare",baseline:"GymnSamhv"},{label:"Lärare i praktisk-estetiska ämnen",education:"Lärarutbildning i praktiskt-estetiskt ämne",column:"PrakEstLarare",baseline:"GymnSamhv"},{label:"Yrkeslärare",education:"Yrkeslärarutbildning",column:"Yrkeslarare",baseline:"GymnSamhv"}]},{name:"Humaniora och konst",nameShort:"Humaniora, Konst",cssClass:"sort",items:[{label:"Humanistisk",education:"Humanistisk utbildning",column:"Humanist",baseline:"GymnSamhv"},{label:"Konstnärlig",education:"Konstnärlig utbildning",column:"Konstutb",baseline:"GymnSamhv"},{label:"Teologisk",education:"Teologisk utbildning",column:"Teolog",baseline:"GymnSamhv"}]}],[{name:"Samhällsvetenskap, juridik, handel och administration",nameShort:"Samhällsv. m.m.",cssClass:"sort",items:[{label:"Biblioteks-/ informationsvetenskaplig",education:"Biblioteks-/informationsvetenskaplig utbildning",column:"Biblinfo",baseline:"GymnSamhv"},{label:"Ekonom",education:"Ekonomiutbildning",column:"Ekonom",baseline:"GymnSamhv"},{label:"Personal-/beteendevetenskaplig",education:"Personal-/beteendevetenskaplig utbildning",column:"Personalvetare",baseline:"GymnSamhv"},{label:"Jurist",education:"Juristutbildning",column:"Jurist",baseline:"GymnSamhv"},{label:"Journalistik/medievetenskaplig",education:"Journalistik-/medievetenskaplig utbildning",column:"Journalist",baseline:"GymnSamhv"},{label:"Psykolog",education:"Psykologutbildning",column:"Psykolog",baseline:"GymnSamhv"},{label:"Samhällsvetenskap/förvaltning",education:"Samhällsvetar-/förvaltningsutbildning",column:"Samhbetvet",baseline:"GymnSamhv"}]}],[{name:"Teknik och tillverkning",nameShort:"Teknik",cssClass:"sort",items:[{label:"Arkitekt",education:"Arkitektutbildning",column:"Arkitekt",baseline:"GymnNatv"},{label:"Civilingenjör",education:"Civilingenjörsutbildning",column:"Civ_ing",baseline:"GymnNatv"},{label:"Högskoleingenjör",education:"Högskoleingenjörsutbildning",column:"Hgsk_ing",baseline:"GymnNatv"}]},{name:"Lant- och skogsbruk samt djursjukvård",nameShort:"Lantbruk, Djursjukvård",cssClass:"sort",items:[{label:"Agronom/hortonom",education:"Agronom/hortonomutbildning",column:"Agronom",baseline:"GymnNatv"},{label:"Veterinär",education:"Veterinärutbildning",column:"Veterinar",baseline:"GymnNatv"}]},{name:"Social omsorg",nameShort:"Social omsorg",cssClass:"sort",items:[{label:"Social omsorg",education:"Social omsorgsutbildning",column:"Soc_omsorg",baseline:"GymnSamhv"},{label:"Socionom",education:"Socionomutbildning",column:"Socionom",baseline:"GymnSamhv"}]}],[{name:"Hälso- och sjukvård",nameShort:"Hälso- och sjukvård",cssClass:"sort",items:[{label:"Apotekare",education:"Apotekarutbildning",column:"Apotekare",baseline:"GymnNatv"},{label:"Arbetsterapeut",education:"Arbetsterapeututbildning",column:"Arbterap",baseline:"GymnSamhv"},{label:"Biomedicinsk analytiker",education:"Biomedicinsk analytikerutbildning",column:"Biomed_analyt",baseline:"GymnSamhv"},{label:"Läkare",education:"Läkarutbildning",column:"Lakare",baseline:"GymnNatv"},{label:"Receptarie",education:"Receptarieutbildning",column:"Receptarie",baseline:"GymnNatv"},{label:"Fysioterapeut",education:"Fysioterapeututbildning",column:"Sjukgymn",baseline:"GymnSamhv"},{label:"Sjuksköterska",education:"Sjuksköterskeutbildning",column:"Sjukskoterska",baseline:"GymnSamhv"},{label:"Tandhygienist",education:"Tandhygienistutbildning",column:"Tandhyg",baseline:"GymnSamhv"},{label:"Tandläkare",education:"Tandläkarutbildning",column:"Tandlakare",baseline:"GymnNatv"}]}],[{name:"Naturvetenskap, matematik, data",nameShort:"Naturvetenskap",cssClass:"sort",items:[{label:"Systemvetenskaplig",education:"Systemvetenskaplig utbildning",column:"Systvet",baseline:"GymnSamhv"},{label:"Geovetenskaplig",education:"Geovetenskaplig utbildning",column:"Geovet",baseline:"GymnNatv"},{label:"Kemist",education:"Kemistutbildning",column:"Kemist",baseline:"GymnNatv"},{label:"Fysiker",education:"Fysikerutbildning",column:"Fysiker",baseline:"GymnNatv"},{label:"Matematiker/statistiker",education:"Matematiker-/statistikerutbildning",column:"Matstat",baseline:"GymnNatv"},{label:"Biolog",education:"Biologiutbildning",column:"Biolog",baseline:"GymnNatv"}]},{name:"Övriga",nameShort:"Sammanräknade",cssClass:"sort",items:[{label:"Akademiker, totalt",education:"Akademisk utbildning i genomsnitt",column:"Akademiker_totalt",baseline:"GymnTotal"}]}]],app.professions=d3.merge(app.professionColumns.map(function(a){return a.map(function(a){return a})})),app.educations=d3.merge(app.professions.map(function(a){return a.items.map(function(a){return a})})),app.educationDictionary={},app.educations.forEach(function(a){app.educationDictionary[a.column]=a}),app.educationDictionary.GymnNatv={education:"P"}}(),$(app).on("app:dataReady",function(a){var b=app.mobile?app.professions:app.professionColumns;$("body").addClass(app.mobile?"mobile":"desktop"),app.chart=new Livsloner(app.selector,app.mobile,app.data,b,app.educationDictionary),app.mobile||app.renderStoryPoints(),app.isIframe=self!==top,app.pymChild=new pym.Child,app.sendHeight()}),function(){var a=[{title:"Utbildning lönar sig inte för alla",content:"För många av de akademiska utbildningarna i vår studie <strong>lönar det sig inte</strong> jämfört med en gymnasieutbildning. De som går dessa utbildningar kan förvänta sig <strong>ekonomisk förlust över livet</strong>. Hit hör bland annat <strong>gruppen lärare</strong>. Läs mer om livslön <a href='http://www.saco.se/vara-fragor/utbildning--forskning/utbildning-ska-lona-sig/' target='_top'>här</a>.",columns:["amneslarare","Arbterap","Biblinfo","Biolog"]},{title:"Höglöneyrken",content:"Den akademiska <strong>utbildning med störst lönsamhet</strong> över livet är läkarutbildningen. På andra plats kommer civilingenjörer och på tredje plats ekonomer. Inom dessa yrken finns det <strong>möjligheter till god löneutveckling</strong>. Det är däremot inte så att alla med dessa utbildningar når de högsta lönerna. Läs mer om livslön <a href='http://www.saco.se/vara-fragor/lon-och-livslon/' target='_top'>här</a>.",columns:["Lakare","Jurist","Systvet","Civ_ing","Ekonom","Tandlakare"]},{title:"16 % högre livslön",content:"Den genomsnittliga lönsamheten för alla akademiska utbildningar är <strong>16 procent</strong>. Men sett över livet är det <strong>stor spridning mellan de som är mest lönsamma och de som är minst lönsamma.</strong> De som har sämst lönsamhet har ett minusresultat på upp till 10 procent, medan de som lönar sig bäst har en lönsamhet på över 50 procent. Läs mer om livslön <a href='http://www.saco.se/vara-fragor/lon-och-livslon/' target='_top'>här</a>.",columns:["Akademiker_totalt"]}],b=function(a){var b=a.attr("data-columns").split(",");$(".profession").prop("checked",function(){var a=$(this).attr("value").split("|")[1];return $.inArray(a,b)>-1}),app.chart.update()};app.renderStoryPoints=function(){var c=d3.select("#story-points-template"),d=c.html(),e=Handlebars.compile(d),f=$("<div/>").html(e(a));f.find(".item").first().addClass("active"),$(app.selector).prepend(f),b($(".item.active")),f.find(".carousel").carousel({interval:!1}).on("slide.bs.carousel",function(a){b($(a.relatedTarget))})}}(),Array.prototype.allValuesSame=function(){for(var a=1;a<this.length;a++)if(this[a]!==this[0])return!1;return!0};